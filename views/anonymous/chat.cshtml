<!DOCTYPE html>
<html lang="@Page.Language">

<head>
	<meta charset="UTF-8">
	<title>@Page.HeadTitle</title>
	@var og = Page.OpenGraph;
	@if (og != null)
	{
		<meta property="og:type" content="@og.Type" />
		<meta property="og:title" content="@og.Title" />
		<meta property="og:description" content="@og.Description" />
		<meta property="og:image" content="@og.Image" />
		<meta property="og:url" content="@og.URL" />

		<meta name="twitter:card" content="summary_large_image">
		<meta name="twitter:title" content="@og.Title">
		<meta name="twitter:description" content="@og.Description">
		<meta name="twitter:image" content="@og.Image">
		<meta name="twitter:url" content="@og.URL">

		<meta name="description" content="@og.Description">
	}
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="theme-color" content="#075e54">
	<link rel="manifest" href="/manifest.json">
	<link rel="stylesheet" href="/lib/prism/prism.css">
	<link rel="stylesheet" href="/lib/spart/spart.css">
	<link rel="stylesheet" href="/css/login.css?v=1.1">
	<link rel="stylesheet" href="/css/chat.css?v=1.1">
	<script defer src="/lib/dompurify/purify.min.js"></script>
	<script defer src="/lib/marked/marked.min.js"></script>
	<script defer src="/lib/prism/prism.js"></script>
	<script defer src="/js/svg.js?v=1.0"></script>
	<script type="importmap">
	{
		"imports": {
			"spart": "/lib/spart/spart.js?v=1.1",
			"fetch": "/lib/spart/fetch.js?v=1.1",
			"i18n": "/lib/spart/i18n.js?v=1.1",
			"login": "/js/login.js?v=1.1",
			"chat": "/js/chat.js?v=1.1"
		}
	}
	</script>
	<script type="module">
		import { initializeApp } from 'login';

		document.addEventListener('DOMContentLoaded', async () => {
			await initializeApp();
			document.getElementById("app-loading-indicator")?.remove();

			if ('serviceWorker' in navigator) {
				await navigator.serviceWorker.register("/sw.js")
					.then(reg => console.debug("Service Worker registered"))
					.catch(err => console.error("SW registration failed:", err));
			}
		});
	</script>
</head>

<body>
	<div id="app-loading-indicator" class="loading-spinner"></div>
	<div id="chat-header">
		<span>@Page.HeadTitle</span>
		<select id="language">
			<option hidden></option>
			<option value="en">EN</option>
			<option value="fr">FR</option>
		</select>
	</div>
	<div id="chat-container">
		<!-- Messages will be dynamically added here -->
	</div>
	<div id="chat-footer">
		<!-- Reply preview box -->
		<div id="reply-preview" class="hidden">
			<span id="reply-text"></span>
			<button id="cancel-reply">âœ•</button>
		</div>
		<div id="input-area">
			<textarea id="message-input" rows="3"></textarea>
			<button id="send-btn"></button>
		</div>
	</div>
</body>

</html>